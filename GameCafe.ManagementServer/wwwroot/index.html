<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Gaming Cafe Management System - Admin Dashboard" />
  <title>Gaming Cafe Admin Dashboard</title>
  <!--
    WCAG 2.0 AA / ISO/IEC 40500:2012 compliance notes:
    - Colour contrast â‰¥ 4.5:1 for normal text, â‰¥ 3:1 for large text (1.4.3)
    - All interactive elements keyboard-focusable (2.1.1)
    - Focus indicators visible (2.4.7)
    - Form inputs have associated <label> elements (1.3.1)
    - Language declared on <html> (3.1.1)
    - No content relies solely on colour to convey information (1.4.1)
    - Skip-to-content link provided (2.4.1)
    - ARIA roles used where semantic HTML is insufficient
    ISO 9241-151: Page layout follows logical reading order; navigation is consistent
  -->
  <style>
    /* === Reset & Base === */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --color-bg:          #0f111a;   /* dark navy */
      --color-surface:     #1a1d2e;
      --color-border:      #2d3250;
      --color-accent:      #4f8ef7;   /* blue â€“ contrast 5.2:1 on surface */
      --color-accent-dark: #3570d4;
      --color-text:        #e8eaf6;   /* off-white â€“ contrast 13.7:1 on surface */
      --color-text-muted:  #9ea3c0;   /* contrast 4.6:1 on surface â€“ AA pass */
      --color-success:     #4caf8f;   /* contrast 5.1:1 */
      --color-warning:     #f5a623;   /* contrast 4.9:1 */
      --color-error:       #e05c5c;   /* contrast 5.3:1 */
      --radius:            8px;
      --focus-ring:        0 0 0 3px rgba(79,142,247,0.6);
    }

    html { font-size: 16px; }

    body {
      background: var(--color-bg);
      color: var(--color-text);
      font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* === Skip Link (WCAG 2.4.1) === */
    .skip-link {
      position: absolute;
      top: -100%;
      left: 1rem;
      background: var(--color-accent);
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 0 0 var(--radius) var(--radius);
      font-weight: bold;
      z-index: 1000;
      text-decoration: none;
    }
    .skip-link:focus { top: 0; }

    /* === Focus ring (WCAG 2.4.7) === */
    :focus-visible { outline: none; box-shadow: var(--focus-ring); }

    /* === Layout === */
    .layout { display: grid; grid-template-columns: 220px 1fr; min-height: 100vh; }

    /* === Sidebar Nav === */
    nav[aria-label="Main navigation"] {
      background: var(--color-surface);
      border-right: 1px solid var(--color-border);
      padding: 1.5rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .nav-logo {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--color-accent);
      margin-bottom: 1.5rem;
      padding: 0 0.5rem;
    }

    nav a {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.6rem 0.75rem;
      border-radius: var(--radius);
      text-decoration: none;
      color: var(--color-text-muted);
      font-size: 0.95rem;
      transition: background 0.15s, color 0.15s;
    }
    nav a:hover, nav a[aria-current="page"] {
      background: rgba(79,142,247,0.15);
      color: var(--color-text);
    }
    nav a[aria-current="page"] { color: var(--color-accent); font-weight: 600; }

    /* === Main Content === */
    main { padding: 2rem; overflow-y: auto; }

    .page-header { margin-bottom: 2rem; }
    .page-header h1 { font-size: 1.75rem; font-weight: 700; }
    .page-header p  { color: var(--color-text-muted); margin-top: 0.25rem; }

    /* === Status Banner === */
    .status-banner {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      padding: 0.75rem 1rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }
    .status-dot {
      width: 10px; height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .status-dot.online  { background: var(--color-success); }
    .status-dot.offline { background: var(--color-error); }

    /* === Stat Cards === */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      padding: 1.25rem;
    }
    .stat-card .label {
      font-size: 0.8rem;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 0.5rem;
    }
    .stat-card .value {
      font-size: 2rem;
      font-weight: 700;
      line-height: 1;
    }
    .stat-card .value.success { color: var(--color-success); }
    .stat-card .value.warning { color: var(--color-warning); }
    .stat-card .value.accent  { color: var(--color-accent); }

    /* === Table === */
    .table-wrapper {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 2rem;
    }
    .table-wrapper h2 {
      padding: 1rem 1.25rem 0.75rem;
      font-size: 1rem;
      font-weight: 600;
      border-bottom: 1px solid var(--color-border);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    thead th {
      background: rgba(255,255,255,0.03);
      padding: 0.65rem 1.25rem;
      text-align: left;
      font-weight: 600;
      color: var(--color-text-muted);
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    tbody td { padding: 0.75rem 1.25rem; border-top: 1px solid var(--color-border); }
    tbody tr:hover { background: rgba(255,255,255,0.02); }

    /* Status badges â€“ use text + shape, not colour alone (WCAG 1.4.1) */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.78rem;
      font-weight: 600;
    }
    .badge::before { content: ""; width: 6px; height: 6px; border-radius: 50%; }
    .badge.available { background: rgba(76,175,143,0.15); color: var(--color-success); }
    .badge.available::before { background: var(--color-success); }
    .badge.in-use    { background: rgba(245,166,35,0.15);  color: var(--color-warning); }
    .badge.in-use::before    { background: var(--color-warning); }
    .badge.offline   { background: rgba(224,92,92,0.15);   color: var(--color-error); }
    .badge.offline::before   { background: var(--color-error); }

    /* === Form Controls === */
    .form-group { margin-bottom: 1rem; }
    label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.35rem;
    }
    input, select {
      width: 100%;
      padding: 0.55rem 0.75rem;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      color: var(--color-text);
      font-size: 0.95rem;
    }
    input:focus, select:focus {
      border-color: var(--color-accent);
      box-shadow: var(--focus-ring);
      outline: none;
    }

    /* === Buttons === */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.55rem 1.1rem;
      border: none;
      border-radius: var(--radius);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.15s;
      text-decoration: none;
    }
    .btn:hover { opacity: 0.85; }
    .btn-primary { background: var(--color-accent); color: #fff; }
    .btn-danger  { background: var(--color-error);  color: #fff; }
    .btn-ghost   { background: transparent; border: 1px solid var(--color-border); color: var(--color-text); }

    /* === Loading spinner === */
    .spinner {
      width: 1.25rem; height: 1.25rem;
      border: 2px solid var(--color-border);
      border-top-color: var(--color-accent);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      display: inline-block;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* === Responsive === */
    @media (max-width: 768px) {
      .layout { grid-template-columns: 1fr; }
      nav[aria-label="Main navigation"] {
        flex-direction: row;
        overflow-x: auto;
        border-right: none;
        border-bottom: 1px solid var(--color-border);
      }
      .nav-logo { display: none; }
    }
  </style>
</head>
<body>
  <!-- Skip link â€“ first focusable element (WCAG 2.4.1) -->
  <a class="skip-link" href="#main-content">Skip to main content</a>

  <div class="layout">
    <!-- â”€â”€ Sidebar Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <nav aria-label="Main navigation">
      <div class="nav-logo" aria-hidden="true">ğŸ® GameCafe</div>

      <a href="#dashboard" aria-current="page" id="nav-dashboard">
        <span aria-hidden="true">ğŸ“Š</span> Dashboard
      </a>
      <a href="#stations" id="nav-stations">
        <span aria-hidden="true">ğŸ–¥ï¸</span> Stations
      </a>
      <a href="#sessions" id="nav-sessions">
        <span aria-hidden="true">â±ï¸</span> Sessions
      </a>
      <a href="#billing" id="nav-billing">
        <span aria-hidden="true">ğŸ’°</span> Billing
      </a>
      <a href="#settings" id="nav-settings">
        <span aria-hidden="true">âš™ï¸</span> Settings
      </a>
    </nav>

    <!-- â”€â”€ Main Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <main id="main-content" tabindex="-1">

      <!-- Dashboard Section -->
      <section id="section-dashboard" aria-labelledby="heading-dashboard">
        <header class="page-header">
          <h1 id="heading-dashboard">Dashboard</h1>
          <p>Live overview of all gaming stations and revenue</p>
        </header>

        <!-- Server status -->
        <div class="status-banner" role="status" aria-live="polite" id="server-status">
          <span class="status-dot online" aria-hidden="true"></span>
          <span>Management Server: <strong>Online</strong> â€” <span id="server-url">http://localhost:5000</span></span>
        </div>

        <!-- Summary stats -->
        <div class="stats-grid" role="region" aria-label="Summary statistics">
          <article class="stat-card">
            <div class="label">Active Stations</div>
            <div class="value success" id="stat-active-stations" aria-live="polite">â€”</div>
          </article>
          <article class="stat-card">
            <div class="label">Active Sessions</div>
            <div class="value accent" id="stat-active-sessions" aria-live="polite">â€”</div>
          </article>
          <article class="stat-card">
            <div class="label">Today's Revenue</div>
            <div class="value warning" id="stat-revenue" aria-live="polite">â€”</div>
          </article>
          <article class="stat-card">
            <div class="label">Total Stations</div>
            <div class="value" id="stat-total-stations" aria-live="polite">â€”</div>
          </article>
        </div>

        <!-- Stations table -->
        <div class="table-wrapper" role="region" aria-label="Station status">
          <h2>Station Status</h2>
          <table id="stations-table" aria-label="Gaming stations">
            <thead>
              <tr>
                <th scope="col">Station ID</th>
                <th scope="col">Name</th>
                <th scope="col">Status</th>
                <th scope="col">Current User</th>
                <th scope="col">Session Duration</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody id="stations-tbody">
              <tr>
                <td colspan="6" style="text-align:center;color:var(--color-text-muted)">
                  <span class="spinner" aria-hidden="true"></span>
                  <span> Loading stationsâ€¦</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Sessions table -->
        <div class="table-wrapper" role="region" aria-label="Active sessions">
          <h2>Active Sessions</h2>
          <table id="sessions-table" aria-label="Active gaming sessions">
            <thead>
              <tr>
                <th scope="col">Session ID</th>
                <th scope="col">User</th>
                <th scope="col">Station</th>
                <th scope="col">Started</th>
                <th scope="col">Duration</th>
                <th scope="col">Cost</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody id="sessions-tbody">
              <tr>
                <td colspan="7" style="text-align:center;color:var(--color-text-muted)">
                  <span class="spinner" aria-hidden="true"></span>
                  <span> Loading sessionsâ€¦</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

    </main>
  </div>

  <script>
    "use strict";

    const API_BASE = window.location.hostname === "localhost"
      ? "http://localhost:5000/api"
      : "/api";

    // â”€â”€ Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function fmtDuration(startISO) {
      const start = new Date(startISO);
      const secs  = Math.floor((Date.now() - start) / 1000);
      const h = Math.floor(secs / 3600).toString().padStart(2,"0");
      const m = Math.floor((secs % 3600) / 60).toString().padStart(2,"0");
      const s = (secs % 60).toString().padStart(2,"0");
      return `${h}:${m}:${s}`;
    }

    function fmtMoney(val) {
      return new Intl.NumberFormat("en-US", { style:"currency", currency:"USD" }).format(val ?? 0);
    }

    function badgeHtml(status) {
      const map = { Available:"available", InUse:"in-use", Offline:"offline" };
      const cls = map[status] ?? "offline";
      return `<span class="badge ${cls}">${status}</span>`;
    }

    // â”€â”€ API fetching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    async function fetchJson(path) {
      try {
        const res = await fetch(`${API_BASE}${path}`, {
          headers: { Accept: "application/json" }
        });
        if (!res.ok) throw new Error(res.statusText);
        return await res.json();
      } catch (err) {
        return null;
      }
    }

    // â”€â”€ Stations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    async function loadStations() {
      const data = await fetchJson("/stations");
      const tbody = document.getElementById("stations-tbody");

      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:var(--color-text-muted)">No stations registered yet</td></tr>`;
        document.getElementById("stat-active-stations").textContent = "0";
        document.getElementById("stat-total-stations").textContent  = "0";
        return;
      }

      const active = data.filter(s => s.status === "InUse").length;
      document.getElementById("stat-active-stations").textContent = active;
      document.getElementById("stat-total-stations").textContent  = data.length;

      tbody.innerHTML = data.map(s => `
        <tr>
          <td>${escHtml(s.stationId ?? s.id ?? "â€”")}</td>
          <td>${escHtml(s.name ?? "â€”")}</td>
          <td>${badgeHtml(s.status ?? "Offline")}</td>
          <td>${escHtml(s.currentUser ?? "â€”")}</td>
          <td>${s.sessionStart ? fmtDuration(s.sessionStart) : "â€”"}</td>
          <td>
            <button class="btn btn-ghost" onclick="endStation('${escHtml(s.stationId ?? s.id)}')">
              End Session
            </button>
          </td>
        </tr>`).join("");
    }

    // â”€â”€ Sessions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    async function loadSessions() {
      const data = await fetchJson("/sessions");
      const tbody = document.getElementById("sessions-tbody");

      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;color:var(--color-text-muted)">No active sessions</td></tr>`;
        document.getElementById("stat-active-sessions").textContent = "0";
        return;
      }

      document.getElementById("stat-active-sessions").textContent = data.length;

      tbody.innerHTML = data.map(s => `
        <tr>
          <td>${escHtml(String(s.sessionId ?? s.id ?? "â€”"))}</td>
          <td>${escHtml(s.username ?? s.userId ?? "â€”")}</td>
          <td>${escHtml(String(s.stationId ?? "â€”"))}</td>
          <td>${s.startTime ? new Date(s.startTime).toLocaleTimeString() : "â€”"}</td>
          <td>${s.startTime ? fmtDuration(s.startTime) : "â€”"}</td>
          <td>${fmtMoney(s.currentCost ?? 0)}</td>
          <td>
            <button class="btn btn-danger" onclick="endSession('${escHtml(String(s.sessionId ?? s.id))}')">
              End
            </button>
          </td>
        </tr>`).join("");
    }

    // â”€â”€ Revenue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    async function loadRevenue() {
      const data = await fetchJson("/billing/analytics");
      if (data) {
        document.getElementById("stat-revenue").textContent = fmtMoney(data.totalRevenue ?? data.TotalRevenue ?? 0);
      } else {
        document.getElementById("stat-revenue").textContent = "$0.00";
      }
    }

    // â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    async function endStation(stationId) {
      if (!confirm(`End session on station "${stationId}"?`)) return;
      await fetch(`${API_BASE}/stations/${stationId}/end`, { method: "POST" });
      refresh();
    }

    async function endSession(sessionId) {
      if (!confirm(`End session #${sessionId}?`)) return;
      await fetch(`${API_BASE}/sessions/${sessionId}/end`, { method: "POST" });
      refresh();
    }

    // â”€â”€ XSS-safe HTML escaping â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function escHtml(str) {
      return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
    }

    // â”€â”€ Refresh loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function refresh() {
      loadStations();
      loadSessions();
      loadRevenue();
    }

    refresh();
    setInterval(refresh, 5000); // auto-refresh every 5 seconds
  </script>
</body>
</html>
